<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SHA-256 해시 함수 테스트 - 000 해시찾기</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, label, button { font-size: 16px; padding: 8px; margin-top: 10px; width: 100%; max-width: 400px; }
    #hashOutput, #status { margin-top: 20px; padding: 10px; background: #f0f0f0; border: 1px solid #ccc; word-break: break-all; }
    .row { margin-bottom: 10px; }
    button { cursor: pointer; }
</style>
</head>
<body>
<h1>SHA-256 해시 함수 테스트</h1>
<div class="row">
  <label for="inputText">입력값 :</label>
  <input type="text" id="inputText" placeholder="여기에 메시지를 입력하세요" autocomplete="off" />
</div>
<div class="row">
  <label for="nonceInput">Nonce 값 :</label>
  <input type="number" id="nonceInput" value="0" min="0" />
</div>
<button id="findNonceBtn">해시가 '000'으로 시작하는 Nonce 찾기</button>
<h2>해시 결과</h2>
<div id="hashOutput">해시 값이 여기에 표시됩니다</div>
<h2>상태</h2>
<div id="status"></div>

<script>
async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

async function updateHash() {
    const input = document.getElementById('inputText').value;
    const nonce = document.getElementById('nonceInput').value;
    const combined = input + nonce;
    const hash = await sha256(combined);
    document.getElementById('hashOutput').textContent = hash;
}

// 버튼 클릭 시 000으로 시작하는 nonce 찾기 (블록체인 채굴 원리 시뮬레이션)
document.getElementById('findNonceBtn').addEventListener('click', async () => {
    const input = document.getElementById('inputText').value;
    if (input === '') {
        alert('먼저 입력값을 입력해주세요!');
        return;
    }

    document.getElementById('status').textContent = 'Nonce 찾는 중... 잠시만 기다려주세요.';
    let nonce = 0;

    while(true) {
        const combined = input + nonce;
        const hash = await sha256(combined);
        if(hash.startsWith('000')) {
            document.getElementById('nonceInput').value = nonce;
            document.getElementById('hashOutput').textContent = hash;
            document.getElementById('status').textContent = `해시 시작값이 '000'인 nonce 찾음: ${nonce}`;
            break;
        }
        nonce++;
        // 연산 사이에 잠시 쉬면서 UI 반응성을 유지
        if(nonce % 1000 === 0) await new Promise(r => setTimeout(r, 0));
    }
});

// 입력 혹은 nonce 변경시 해시 자동 갱신
document.getElementById('inputText').addEventListener('input', updateHash);
document.getElementById('nonceInput').addEventListener('input', updateHash);

// 초기 해시 표시
window.addEventListener('DOMContentLoaded', updateHash);
</script>
</body>
</html>
